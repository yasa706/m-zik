<!doctype html>
<html lang="zh-CN">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>GitHub Auto Music Player</title>
<style>
  body{background:#0f172a;color:white;font-family:Arial;text-align:center;padding:40px;}
  #player{width:100%;max-width:400px;margin:auto;}
  audio{width:100%;}
  ul{list-style:none;padding:0;margin-top:20px;}
  li{padding:8px;cursor:pointer;border-bottom:1px solid #334155;}
  li:hover{background:#1e293b;}
</style>
</head>
<body>

<h2>ğŸµ åŸºç£æ•™éŸ³ä¹æ’­æ”¾å™¨</h2>
<div id="player">
  <audio id="audio" controls></audio>
</div>

<ul id="playlist"></ul>

<script>
const owner = "yasa706";
const repo  = "m-zik";
const branch = "main";

// è‡ªå®šä¹‰æ˜¾ç¤ºåç§°æ˜ å°„
const trackNames = {
  "sg.mp3": "æ•¬æ‹œè¯—æ­Œï¼šä¸»å•Šæˆ‘æ¥åˆ°ä½ é¢å‰",
  "wnh.mp3": "å®‰é™åœ¨ä¸»é¢å‰",
  "ysl.mp3": "ä½ æ˜¯æˆ‘çš„åŠ›é‡"
};

async function loadTracks() {
  const apiURL = `https://api.github.com/repos/${owner}/${repo}/contents/?ref=${branch}`;
  const res = await fetch(apiURL);
  const data = await res.json();

  // ç­›é€‰ mp3 æ–‡ä»¶
  const mp3Files = data.filter(item => item.name.endsWith(".mp3"));

  return mp3Files.map(file => ({
    title: trackNames[file.name] || file.name.replace(".mp3", ""),
    url: `https://raw.githubusercontent.com/${owner}/${repo}/${branch}/${file.name}`
  }));
}

async function initPlayer() {
  const tracks = await loadTracks();
  const audio = document.getElementById("audio");
  const playlist = document.getElementById("playlist");

  if (tracks.length === 0) {
    playlist.innerHTML = "<li>ä»“åº“ä¸­æ²¡æœ‰ mp3 æ–‡ä»¶</li>";
    return;
  }

  tracks.forEach((track, i) => {
    const li = document.createElement("li");
    li.textContent = track.title;
    li.onclick = () => playTrack(i);
    playlist.appendChild(li);
  });

  let current = 0;

  function playTrack(index){
    current = index;
    audio.src = tracks[index].url;
    audio.play();
  }

  // è‡ªåŠ¨æ’­æ”¾ä¸‹ä¸€é¦–
  audio.onended = () => {
    current = (current + 1) % tracks.length;
    playTrack(current);
  };

  playTrack(0); // è‡ªåŠ¨æ’­æ”¾ç¬¬ä¸€é¦–
}

initPlayer();
</script>

</body>
</html>
